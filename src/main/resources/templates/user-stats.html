<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Statistiques - Loto Master</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<nav class="navbar navbar-dark navbar-custom shadow-sm mb-4">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center gap-2" th:href="@{/}">
            <i class="bi bi-arrow-left-circle-fill"></i> Retour au Dashboard
        </a>
        <span class="text-white fw-bold">Mon ADN de Joueur üß¨</span>
    </div>
</nav>

<div class="container pb-5">

    <div class="row g-3 mb-4 animate-up">
        <div class="mb-4 animate-up delay-1">
            <h5 class="fw-bold mb-3 text-secondary">
                <i class="bi bi-calendar-week-fill me-2 text-primary"></i>Rentabilit√© par Jour
            </h5>

            <div class="row g-4">
                <div class="col-md-4" th:each="entry : ${stats.performanceParJour}">

                    <div class="card border-0 shadow-sm h-100 day-card position-relative overflow-hidden"
                         style="transition: transform 0.2s;"
                         onmouseover="this.style.transform='translateY(-5px)'"
                         onmouseout="this.style.transform='translateY(0)'">

                        <div class="position-absolute top-0 bottom-0 start-0" style="width: 4px;"
                             th:classappend="${entry.value.solde >= 0} ? 'bg-success' : 'bg-danger'"></div>

                        <div class="card-body ps-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div>
                                    <h6 class="fw-bold mb-1 text-uppercase text-dark" th:text="${entry.value.jourNom}">LUNDI</h6>
                                    <span class="badge bg-light text-muted border fw-normal">
                                    <span th:text="${entry.value.nbJeux}">0</span> participations
                                </span>
                                </div>

                                <div class="rounded-circle p-2 d-flex align-items-center justify-content-center"
                                     style="width: 38px; height: 38px;"
                                     th:classappend="${entry.value.solde >= 0} ? 'bg-success bg-opacity-10 text-success' : 'bg-danger bg-opacity-10 text-danger'">
                                    <i class="bi" th:classappend="${entry.value.solde >= 0} ? 'bi-graph-up-arrow' : 'bi-graph-down-arrow'"></i>
                                </div>
                            </div>

                            <div class="mb-3">
                                <small class="text-muted text-uppercase fw-bold" style="font-size: 0.65rem;">Bilan Net</small>
                                <h3 class="fw-bold mb-0"
                                    th:classappend="${entry.value.solde >= 0} ? 'text-success' : 'text-danger'"
                                    th:text="${(entry.value.solde > 0 ? '+' : '') + #numbers.formatDecimal(entry.value.solde, 1, 2) + ' ‚Ç¨'}">
                                    0.00 ‚Ç¨
                                </h3>
                            </div>

                            <hr class="my-2 border-light">

                            <div class="row text-center small">
                                <div class="col-6 border-end">
                                    <span class="text-muted d-block" style="font-size: 0.65rem;">D√âPENS√â</span>
                                    <span class="fw-bold text-dark" th:text="${#numbers.formatDecimal(entry.value.depense, 1, 2) + '‚Ç¨'}">0‚Ç¨</span>
                                </div>
                                <div class="col-6">
                                    <span class="text-muted d-block" style="font-size: 0.65rem;">GAGN√â</span>
                                    <span class="fw-bold text-dark" th:text="${#numbers.formatDecimal(entry.value.gains, 1, 2) + '‚Ç¨'}">0‚Ç¨</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 border-0 shadow-sm text-center">
                <small class="text-muted text-uppercase fw-bold">Grilles Jou√©es</small>
                <h2 class="text-primary fw-bold mb-0" th:text="${stats.totalGrilles}">0</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 border-0 shadow-sm text-center">
                <small class="text-muted text-uppercase fw-bold">Investissement</small>
                <h2 class="text-danger fw-bold mb-0" th:text="${#numbers.formatDecimal(stats.depenseTotale, 1, 2) + ' ‚Ç¨'}">0 ‚Ç¨</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 border-0 shadow-sm text-center">
                <small class="text-muted text-uppercase fw-bold">Gain Total</small>
                <h2 class="text-success fw-bold mb-0" th:text="${#numbers.formatDecimal(stats.gainTotal, 1, 2) + ' ‚Ç¨'}">0 ‚Ç¨</h2>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card p-3 border-0 shadow-sm text-center bg-primary bg-opacity-10">
                <small class="text-primary text-uppercase fw-bold">Somme Moyenne</small>
                <h2 class="text-primary fw-bold mb-0" th:text="${#numbers.formatDecimal(stats.moyenneSomme, 1, 0)}">0</h2>
                <small class="text-muted" style="font-size: 0.7rem">Cible id√©ale : 140-160</small>
            </div>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-md-4 animate-up delay-1">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white fw-bold"><i class="bi bi-yin-yang me-2 text-primary"></i>Parit√© de vos jeux</div>
                <div class="card-body d-flex flex-column align-items-center justify-content-center">
                    <div style="height: 200px; width: 200px;">
                        <canvas id="parityChart"></canvas>
                    </div>
                    <div class="mt-3 text-center">
                        <span class="badge bg-primary bg-opacity-10 text-primary border border-primary p-2">
                            Moyenne : <span th:text="${stats.pariteMoyenne}"></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-8 animate-up delay-2">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white fw-bold"><i class="bi bi-bar-chart-fill me-2 text-primary"></i>Vos Num√©ros Favoris</div>
                <div class="card-body">
                    <canvas id="freqChart" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4 animate-up delay-3">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-danger text-white fw-bold">
                    <i class="bi bi-heart-fill me-2"></i>Vos Num√©ros Chance F√©tiches
                </div>
                <div class="card-body text-center">
                    <div class="d-flex justify-content-center gap-3">
                        <div th:each="c : ${stats.topChance}" class="text-center">
                            <div class="badge rounded-circle bg-danger fs-4 shadow-sm d-flex align-items-center justify-content-center mb-2"
                                 style="width: 50px; height: 50px;" th:text="${c.numero}"></div>
                            <small class="text-muted d-block">Jou√© <strong th:text="${c.count}"></strong>x</small>
                        </div>
                        <div th:if="${#lists.isEmpty(stats.topChance)}" class="text-muted fst-italic">Pas assez de donn√©es.</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-secondary text-white fw-bold">
                    <i class="bi bi-eye-slash-fill me-2"></i>Ceux que vous ne jouez jamais
                </div>
                <div class="card-body">
                    <p class="small text-muted mb-2">Essayez de les jouer pour surprendre le hasard ?</p>
                    <div class="d-flex flex-wrap gap-1">
                        <span th:each="n : ${stats.numJamaisJoues}"
                              class="badge bg-light text-secondary border fw-normal"
                              th:text="${n}"></span>
                        <span th:if="${#lists.isEmpty(stats.numJamaisJoues)}" class="badge bg-success">Bravo, vous jouez tout !</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script th:inline="javascript">
    document.addEventListener("DOMContentLoaded", function() {
        // Donn√©es inject√©es par Thymeleaf
        const pairs = /*[[${stats.totalPairsJoues}]]*/ 0;
        const impairs = /*[[${stats.totalImpairsJoues}]]*/ 0;

        const topBoules = /*[[${stats.topBoules}]]*/ [];
        const labelsBoules = topBoules.map(b => 'N¬∞ ' + b.numero);
        const dataBoules = topBoules.map(b => b.count);

        // 1. Chart Parit√© (Doughnut)
        new Chart(document.getElementById('parityChart'), {
            type: 'doughnut',
            data: {
                labels: ['Pairs', 'Impairs'],
                datasets: [{
                    data: [pairs, impairs],
                    backgroundColor: ['#4F46E5', '#10B981'], // Violet et Vert
                    borderWidth: 0
                }]
            },
            options: {
                cutout: '70%',
                plugins: { legend: { position: 'bottom' } }
            }
        });

        // 2. Chart Fr√©quence (Bar)
        new Chart(document.getElementById('freqChart'), {
            type: 'bar',
            data: {
                labels: labelsBoules,
                datasets: [{
                    label: 'Nombre de fois jou√©',
                    data: dataBoules,
                    backgroundColor: 'rgba(79, 70, 229, 0.7)',
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } },
                plugins: { legend: { display: false } }
            }
        });
    });
</script>

</body>
</html>
